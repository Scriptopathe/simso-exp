{% extends "index.html" %}


{% block content %}

{% load staticfiles %}
<script src="{% static 'ace.js' %}" type="text/javascript" charset="utf-8"></script>
<div class="well">
    <h4>Welcome to Simso Experiment Database.</h4>
    Here you can validate the submissions of the users.<br />
</div>

<div class="well">
    <h4>Schedulers</h4>
    {% for sched in scheds %}
    
    <div class="panel panel-primary" id="panel{{sched.id}}">
    	<div class="well well-sm" 
    		data-toggle="collapse"
    		style="margin-bottom: 0px; cursor: pointer;"
    		data-target="#collapse{{ sched.id }}">
            <button 
                data-toggle="tooltip" data-placement="top" title="Deletes this scheduler proposition."
                class="btn btn-danger" id="remove{{sched.id}}"><span class="glyphicon glyphicon-remove"></span></button>
            <button 
                data-toggle="tooltip" data-placement="top" title="Validates this scheduler."
                class="btn btn-success" id="validate{{sched.id}}"><span class="glyphicon glyphicon-ok"></span></button>
            <b>{{sched.name}}</b>
        </div>
        
          
    	<div id="collapse{{ sched.id }}" class="panel-collapse collapse">
            <br />
            <div class="form-horizontal">
                <div class="form-group">
                    <label class="control-label col-sm-2">Class name :  </label>
                    <div class="col-sm-4">
                        <input disabled class="form-control" type="text" value="{{sched.class_name}}"></input>
                    </div>
                </div>
                <div class="editor" id="editor{{ sched.id }}" style="height: 400px">{% autoescape on %}{{ sched.code }}{% endautoescape %}
                </div>
                <script>
                    var editor = ace.edit("editor{{sched.id}}");
                    editor.setTheme("ace/theme/chrome");
                    editor.getSession().setMode("ace/mode/python");
                    $("#remove{{sched.id}}").click(function(e) {
                        e.stopPropagation();
                        $("#deleteModalId").text("{{sched.id}}");
                        $("#deleteModal").modal('show');
                    });
                    
                    $("#validate{{sched.id}}").click(function(e) {
                       e.stopPropagation();
                       $.get("{% url 'simsoexp.views.scheduler_validation_action' %}", {
                           'action' : 'validate',
                           'id' : '{{sched.id}}'
                       }, function(data) {
                            if(data == "success")
                                $("#panel{{sched.id}}").fadeOut(100);
                           
                       });
                    });
                </script>
            </div>
                
    	</div>
    </div>

        
    {% empty %}
        <p>No item to display.</p>
    {% endfor %}
    <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog">
    	<div class="modal-dialog">
    		<div class="modal-content">
    			<div class="modal-header">
    				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    				<h4 class="modal-title">Request deletion</h4>
    			</div>
    			<div class="modal-body">
                    <span id="deleteModalId" style="display: none"></span>
    				<p>Please explain why you did not validate the request.</p>
    				<textarea class="form-control" id="deleteReasonArea"></textarea>
                    
    			</div>
                <div class="modal-footer">
                    <button id="deleteModalSubmit" data-dismiss="modal" type="button" class="btn btn-primary">Delete this !</button>
                    
                </div>
                <script>
                    $("#deleteModalSubmit").click(function() {
                        var schedId = $("#deleteModalId").text();
                        var reason = $("#deleteReasonArea").val();
                        
                        $.get("{% url 'simsoexp.views.scheduler_validation_action' %}", {
                                'action' : 'delete',
                                'id' : schedId,
                                'reason' : reason
                        }, function(data) {
                            if(data == "success")
                                $("#panel" + schedId).fadeOut(100);
                        });
                    });
                </script>
    		</div>
    	</div>
    </div>

    
    <script>
        $(document).ready(function() {
    		$('[data-toggle="tooltip"]').tooltip();
        });
    </script>
</div>

{% endblock %}

