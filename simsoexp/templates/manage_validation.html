{% extends "index.html" %}


{% block content %}

{% load staticfiles %}
<script src="{% static 'ace.js' %}" type="text/javascript" charset="utf-8"></script>
<div class="well">
    <h4>Welcome to Simso Experiment Database.</h4>
    Here you can validate the submissions of the users.<br />
</div>
<ul class="nav nav-pills nav-justified">
      <li role="presentation" {% if type == 'scheduler' %} class="active" {% endif %}>
          <a href="{% url 'simsoexp.views.manage_validation' %}?type=scheduler">Schedulers</a>
      </li>
      <li role="presentation" {% if type != 'scheduler' %} class="active" {% endif %}>
          <a href="{% url 'simsoexp.views.manage_validation' %}?type=results">Experiment Results</a>
      </li>
</ul>
<div class="well">
    <h4>Submitted items</h4>
    {% for item in items %}
    
    <div class="panel panel-primary" id="panel{{item.id}}">
    	<div class="well well-sm" 
    		data-toggle="collapse"
    		style="margin-bottom: 0px; cursor: pointer;"
    		data-target="#collapse{{ item.id }}">
            
            <div class="row">
                <div class="col-sm-2" style="border-right: 1px dashed #333; width: 110px;">
                    <button 
                        data-toggle="tooltip" data-placement="top" title="Deletes this {{type}} proposition."
                        class="btn btn-danger btn-sm" id="remove{{item.id}}"><span class="glyphicon glyphicon-remove"></span></button>
                    <button 
                        data-toggle="tooltip" data-placement="top" title="Validates this {{type}}."
                        class="btn btn-success btn-sm" id="validate{{item.id}}"><span class="glyphicon glyphicon-ok"></span></button>
                    
                </div>
                <div class="col-sm-1" style="padding-top: 3px">
                    <center><span class="badge">{{item.contributor.username}}</span></center>
                </div>
                <div class="col-sm-8" style="padding-top: 3px">
                    {{item.name}}
                </div>
            </div>
            
             
        </div>
        
        <!-- Button script -->
        <script>
            $("#remove{{item.id}}").click(function(e) {
                e.stopPropagation();
                $("#deleteModalId").text("{{item.id}}");
                $("#deleteModal").modal('show');
            });
            
            $("#validate{{item.id}}").click(function(e) {
               e.stopPropagation();
               var url = "{% url 'simsoexp.views.validation_action' %}";
               $.get(url, {
                   'action' : 'validate',
                   'id' : '{{item.id}}',
                   'type' : '{{type}}'
               }, function(data) {
                    if(data == "success")
                        $("#panel{{item.id}}").fadeOut(100);
                   
               });
            });
        </script>
        
    	<div id="collapse{{ item.id }}" class="panel-collapse collapse">
            <br />
            <div class="form-horizontal">
                
                <!-- Schedulers -->
                {% if type == "schedulers" %}
                <div class="form-group">
                    <label class="control-label col-sm-2">Class name :  </label>
                    <div class="col-sm-4">
                        <input disabled class="form-control" type="text" value="{{item.class_name}}"></input>
                    </div>
                </div>
                <div class="editor" id="editor{{ item.id }}" style="height: 400px">{% autoescape on %}{{ item.code }}{% endautoescape %}</div>
                <script>
                    var editor = ace.edit("editor{{item.id}}");
                    editor.setTheme("ace/theme/chrome");
                    editor.getSession().setMode("ace/mode/python");
                </script>
                <!-- Results -->
                {% else %}
                <table class="table table-bordered table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Count</th>
                            <th>Average</th>
                            <th>Std. Dev.</th>
                            <th>Median</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for metric in item.metrics.all %}
                        <tr>
                            <td>{{metric.name}}</td>
                            <td>{{metric.count}}</td>
                            <td>{{metric.avg}}</td>
                            <td>{{metric.std}}</td>
                            <td>{{metric.median}}</td>
                        </tr>                        
                        {% endfor %}
                    </tbody>
                </table>
                
                {% endif %}

            </div>
                
    	</div>
    </div>

        
    {% empty %}
        <p>No item to display.</p>
    {% endfor %}
    
    <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog">
    	<div class="modal-dialog">
    		<div class="modal-content">
    			<div class="modal-header">
    				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    				<h4 class="modal-title">Request deletion</h4>
    			</div>
    			<div class="modal-body">
                    <span id="deleteModalId" style="display: none"></span>
    				<p>Please explain why you did not validate the request.</p>
    				<textarea class="form-control" id="deleteReasonArea"></textarea>
                    
    			</div>
                <div class="modal-footer">
                    <button id="deleteModalSubmit" data-dismiss="modal" type="button" class="btn btn-primary">Delete this !</button>
                </div>
                <script>
                    $("#deleteModalSubmit").click(function() {
                        var itemId = $("#deleteModalId").text();
                        var reason = $("#deleteReasonArea").val();
                        var url = "{% url 'simsoexp.views.validation_action' %}";
                        $.get(url, {
                                'action' : 'delete',
                                'type' : '{{type}}',
                                'id' : itemId,
                                'reason' : reason
                        }, function(data) {
                            if(data == "success")
                                $("#panel" + itemId).fadeOut(100);
                        });
                    });
                </script>
    		</div>
    	</div>
    </div>
    
    <center><ul class="pagination">
        <li>
          <a href="{% url 'simsoexp.views.manage_validation' %}?page=0&type={{type}}" aria-label="First">
            <span aria-hidden="true">&laquo; First</span>
          </a>
        </li>
        {% for pageId in pagesDisp %}
        
        {% if pageId == page %}
        <li class="active"><a><b>{{pageId}}</b></a></li>
        
        {% else %}
        <li><a href="{% url 'simsoexp.views.manage_validation' %}?page={{pageId}}&type={{type}}">{{pageId}}</a></li>
        
        {% endif %}
        {% endfor %}
        <li>
          <a href="{% url 'simsoexp.views.manage_validation' %}?page={{pagesCount}}&type={{type}}" aria-label="Last">
            <span aria-hidden="true">Last &raquo;</span>
          </a>
        </li>
    </ul></center>
    
    <script>
        $(document).ready(function() {
    		$('[data-toggle="tooltip"]').tooltip();
        });
    </script>
</div>

{% endblock %}

